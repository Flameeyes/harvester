<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0"
  xmlns="http://purl.org/rss/1.0/"
  xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:hv="http://astroblog.spaceboyz.net/harvester/xslt-functions"
  exclude-result-prefixes="xsl hv">

<xsl:output method="xml"
            version="1.0"
            encoding="utf-8"
            indent="yes"/>

<xsl:template match="/collections">
  <rdf:RDF>
    <channel rdf:about="http://astroblog.spaceboyz.net/harvester/rss.rdf">
      <title>Blog Harvester</title>
      <link>http://astroblog.spaceboyz.net/harvester/</link>
      <description>&lt;p&gt;&lt;a href="http://astroblog.spaceboyz.net/harvester/"&gt;Blog Harvester&lt;/a&gt; sammelt Blogs von Menschen rund um Astro&lt;/p&gt;&lt;Enthalten sind:&lt;ul&gt;
        <xsl:for-each select="collection[@name='blogs']/feed">
          <xsl:sort select="translate(title, 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz')"/>
          &lt;li&gt;&lt;a href="<xsl:value-of select="link"/>" title="<xsl:value-of select="description"/>"&gt;<xsl:value-of select="title"/>&lt;/a&gt;&lt;/li&gt;
        </xsl:for-each>
        &lt;/ul&gt;</description>
    </channel>

    <xsl:variable name="blogs" select="collection[@name='blogs']"/>
    <xsl:for-each select="hv:collection-items('blogs')/item">
      <xsl:variable name="rss" select="string(rss)"/>
      <xsl:variable name="feed" select="$blogs/feed[rss=$rss]"/>
      <item>
        <title><xsl:value-of select="concat($feed/title,': ',title)"/></title>
        <link><xsl:value-of select="link"/></link>
        <guid isPermaLink="yes"><xsl:value-of select="$feed/link"/></guid>
        <pubDate><xsl:value-of select="date"/></pubDate>
        <description>
          <xsl:value-of select="hv:item-description($rss, string(link))"/>
        </description>
        <source url="{$feed/link}"><xsl:value-of select="$feed/title"/></source>
      </item>
    </xsl:for-each>
  </rdf:RDF>
</xsl:template>

</xsl:stylesheet>
